(function(){"use strict";const m={top_bar_height:2,top_bar_margin:.5,top_bar_padding:0,hex_grid_side_border:10,hex_grid_top_border:60,hex_grid_bottom_border:10,canvas_pixel_limit:8e3,hexagon_stroke_width:.1},l={unset:"#FFFFFF",ocean:"#a5c6fa",mountain:"#9d9fa1",bog:"#ffe4fd",forest:"#a1e070",plains:"#ddfec3",desert:"#fae4a7",hills:"#d1d2d3",white:"#ffffff",black:"#000000",road:"#664900",red:"#a83232",disabled:"#c2c2c2"};function c(r){return Math.round(Math.sqrt(3)*r)}function h(r){return r*2}function z(r){return r/2}function a(r,i){const o=r.row_number,t=r.column_number,_=c(i),s=(o%2==1?_/2:0)+_/2+_*(t-1)+m.hex_grid_side_border,u=m.hex_grid_top_border+i+i*1.5*(o-1);return[s,u]}function S(r,i){const o=c(i),[t,_]=a(r,i);return[{x:t,y:_-i},{x:t+o/2,y:_-i/2},{x:t+o/2,y:_+i/2},{x:t,y:_+i},{x:t-o/2,y:_+i/2},{x:t-o/2,y:_-i/2}]}function F(r,i){const o=c(i),[t,_]=a(r,i);return{top_left:{x:t-o/4,y:_-i*.75},top_right:{x:t+o/4,y:_-i*.75},right:{x:t+o/2,y:_},bottom_right:{x:t+o/4,y:_+i*.75},bottom_left:{x:t-o/4,y:_+i*.75},left:{x:t-o/2,y:_}}}function I(r,i){const o=c(i),[t,_]=a(r,i);return[{x:t,y:_-i/1.5},{x:t+o/2.5,y:_-i/5},{x:t+o/3,y:_-i/5},{x:t+o/3,y:_+i/2},{x:t-o/3,y:_+i/2},{x:t-o/3,y:_-i/5},{x:t-o/2.5,y:_-i/5}]}function L(r){const i=new Path2D;i.moveTo(r[0].x,r[0].y);for(let o=1;o<r.length;o++)i.lineTo(r[o].x,r[o].y);return i.closePath(),i}function M(r,i){return i*(r*1.5)+m.hex_grid_top_border+r/2+m.hex_grid_bottom_border}function A(r,i){const o=c(r);return m.hex_grid_side_border*2+o/2+o*i}function G(r,i,o){return o=="town"?I(r,i):[{x:0,y:0}]}function N(r,i,o){const t=b.get_canvas_path_2d(S(r,o));i.fillStyle=r.background_color_hexidecimal,i.fill(t),i.lineWidth=m.hexagon_stroke_width,i.strokeStyle=l.black,i.stroke(t)}function C(r,i,o){if(r.icon_name){const t=b.get_canvas_path_2d(G(r,o,"town"));i.lineJoin="round",i.lineWidth=10,i.fillStyle=l.black,i.strokeStyle=l.black,i.setLineDash([]),i.stroke(t),i.fill(t)}}function E(r,i,o){if(r.town_size>0){i.fillStyle=l.white,i.textAlign="center",i.textBaseline="middle";const t=o/2;i.font=t+"px sans-serif";const[_,s]=a(r,o);i.fillText(r.town_size.toString()+r.race.toString()+r.affinity.toString(),_,s)}}function n(r,i,o,t,_,s,u,e){r.setLineDash([]),u&&r.setLineDash([e/4]),r.strokeStyle=s,r.lineCap="butt",r.lineWidth=10,r.fillStyle=s,r.beginPath(),r.arc(i,o,5,0,2*Math.PI),r.fill(),r.beginPath(),r.moveTo(i,o),r.lineTo(t,_),r.stroke()}function H(r,i,o){const[t,_]=a(r,o),s=F(r,o);r.is_top_left_river&&n(i,t,_,s.top_left.x,s.top_left.y,l.ocean,!1,o),r.is_top_right_river&&n(i,t,_,s.top_right.x,s.top_right.y,l.ocean,!1,o),r.is_right_river&&n(i,t,_,s.right.x,s.right.y,l.ocean,!1,o),r.is_bottom_right_river&&n(i,t,_,s.bottom_right.x,s.bottom_right.y,l.ocean,!1,o),r.is_bottom_left_river&&n(i,t,_,s.bottom_left.x,s.bottom_left.y,l.ocean,!1,o),r.is_left_river&&n(i,t,_,s.left.x,s.left.y,l.ocean,!1,o),r.is_top_left_road&&n(i,t,_,s.top_left.x,s.top_left.y,l.road,!!r.is_top_left_river,o),r.is_top_right_road&&n(i,t,_,s.top_right.x,s.top_right.y,l.road,!!r.is_top_right_river,o),r.is_right_road&&n(i,t,_,s.right.x,s.right.y,l.road,!!r.is_right_river,o),r.is_bottom_right_road&&n(i,t,_,s.bottom_right.x,s.bottom_right.y,l.road,!!r.is_bottom_right_river,o),r.is_bottom_left_road&&n(i,t,_,s.bottom_left.x,s.bottom_left.y,l.road,!!r.is_bottom_left_river,o),r.is_left_road&&n(i,t,_,s.left.x,s.left.y,l.road,!!r.is_left_river,o)}function W(r,i,o,t){i.fillStyle=t;const[_,s]=a(r,o);i.beginPath(),i.arc(_,s,o/2,0,2*Math.PI),i.fill()}function B(r,i,o){N(r,i,o),H(r,i,o),C(r,i,o),E(r,i,o)}function q(r,i){const o=[r.column_number];return(r.row_number==i.row_number||r.row_number%2==1)&&o.push(r.column_number+1),(r.row_number==i.row_number||r.row_number%2==0)&&o.push(r.column_number-1),!!(Math.abs(r.row_number-i.row_number)<2&&o.includes(i.column_number))}function J(r,i,o){r.row_number==i.row_number&&r.column_number==i.column_number||(r.row_number==i.row_number?i.column_number>r.column_number?o=="river"?(r.is_right_river=!0,i.is_left_river=!0):o=="road"&&(r.is_right_road=!0,i.is_left_road=!0):o=="river"?(r.is_left_river=!0,i.is_right_river=!0):o=="road"&&(r.is_left_road=!0,i.is_right_road=!0):i.row_number<r.row_number?r.row_number%2==1?i.column_number==r.column_number?o=="river"?(r.is_top_left_river=!0,i.is_bottom_right_river=!0):o=="road"&&(r.is_top_left_road=!0,i.is_bottom_right_road=!0):o=="river"?(r.is_top_right_river=!0,i.is_bottom_left_river=!0):o=="road"&&(r.is_top_right_road=!0,i.is_bottom_left_road=!0):i.column_number==r.column_number?o=="river"?(r.is_top_right_river=!0,i.is_bottom_left_river=!0):o=="road"&&(r.is_top_right_road=!0,i.is_bottom_left_road=!0):o=="river"?(r.is_top_left_river=!0,i.is_bottom_right_river=!0):o=="road"&&(r.is_top_left_road=!0,i.is_bottom_right_road=!0):r.row_number%2==1?i.column_number==r.column_number?o=="river"?(r.is_bottom_left_river=!0,i.is_top_right_river=!0):o=="road"&&(r.is_bottom_left_road=!0,i.is_top_right_road=!0):o=="river"?(r.is_bottom_right_river=!0,i.is_top_left_river=!0):o=="road"&&(r.is_bottom_right_road=!0,i.is_top_left_road=!0):i.column_number==r.column_number?o=="river"?(r.is_bottom_right_river=!0,i.is_top_left_river=!0):o=="road"&&(r.is_bottom_right_road=!0,i.is_top_left_road=!0):o=="river"?(r.is_bottom_left_river=!0,i.is_top_right_river=!0):o=="road"&&(r.is_bottom_left_road=!0,i.is_top_right_road=!0))}function p(){return{row_number:1,column_number:1,background_color_hexidecimal:l.white,is_top_left_river:!1,is_top_right_river:!1,is_right_river:!1,is_bottom_right_river:!1,is_bottom_left_river:!1,is_left_river:!1,is_top_left_road:!1,is_top_right_road:!1,is_right_road:!1,is_bottom_right_road:!1,is_bottom_left_road:!1,is_left_road:!1,town_size:0,affinity:0,race:0,icon_name:""}}function y(r,i){const t="0",_=r.toString().padStart(3,t),s=i.toString().padStart(3,t);return _+"_"+s}function O(r){const i=[],o=parseInt(r.height),t=parseInt(r.width);for(let _=1;_<=o;_++)for(let s=1;s<=t;s++){const u=y(_,s),e=r[u];e!=null?i.push({...p(),...w(u,e)}):i.push({...p(),row_number:_,column_number:s})}return i}function P(r){return r.background_color_hexidecimal+"_"+(r.is_top_left_river?1:0)+"_"+(r.is_top_right_river?1:0)+"_"+(r.is_right_river?1:0)+"_"+(r.is_bottom_right_river?1:0)+"_"+(r.is_bottom_left_river?1:0)+"_"+(r.is_left_river?1:0)+"_"+(r.is_top_left_road?1:0)+"_"+(r.is_top_right_road?1:0)+"_"+(r.is_right_road?1:0)+"_"+(r.is_bottom_right_road?1:0)+"_"+(r.is_bottom_left_road?1:0)+"_"+(r.is_left_road?1:0)+"_"+r.town_size+"_"+r.affinity+"_"+r.race+"_"+r.icon_name}function w(r,i){const o=i.split("_"),t=b.get_default_hexagon_definition(),_=parseInt(r.split("_")[0]),s=parseInt(r.split("_")[1]);return t.row_number=_,t.column_number=s,t.background_color_hexidecimal=o[0],t.is_top_left_river=o[1]=="1",t.is_top_right_river=o[2]=="1",t.is_right_river=o[3]=="1",t.is_bottom_right_river=o[4]=="1",t.is_bottom_left_river=o[5]=="1",t.is_left_river=o[6]=="1",t.is_top_left_road=o[7]=="1",t.is_top_right_road=o[8]=="1",t.is_right_road=o[9]=="1",t.is_bottom_right_road=o[10]=="1",t.is_bottom_left_road=o[11]=="1",t.is_left_road=o[12]=="1",t.town_size=parseInt(o[13]),t.affinity=parseInt(o[14]),t.race=parseInt(o[15]),t.icon_name=o[16],t}function R(r,i){const o=[];for(let t=0;t<r.length;t++){const _=r[t],s=P(_),u=y(_.row_number,_.column_number),e=i[u];if(e!=null&&s!=e){const k=w(u,e);o.push(k)}}return o}const b={get_short_diagonal_length:c,get_long_diagonal_length:h,get_peak_height:z,get_hexagon_points:S,get_canvas_path_2d:L,get_canvas_height:M,get_canvas_width:A,get_center_point:a,get_house_points:I,paint_hexagon:B,is_neighboring_hex:q,paint_circle:W,add_path_definition:J,get_default_hexagon_definition:p,get_starting_hexagon_definitions:O,get_hexagon_definition_key:y,get_decoded_hexagon_definition:w,get_encoded_hexagon_definition:P,get_changed_hexagon_definitions:R},j={background_color_hexidecimal:l.white,is_top_left_river:!1,is_top_right_river:!1,is_right_river:!1,is_bottom_right_river:!1,is_bottom_left_river:!1,is_left_river:!1,is_top_left_road:!1,is_top_right_road:!1,is_right_road:!1,is_bottom_right_road:!1,is_bottom_left_road:!1,is_left_road:!1,town_size:0,affinity:0,race:0,icon_name:""};onmessage=r=>{const i=r.data.edge_length,o=r.data.num_rows,t=r.data.num_columns,_=r.data.hexagon_definitions,s=b.get_canvas_height(i,o),u=b.get_canvas_width(i,t);for(let f=1;f<=o;f++)for(let v=1;v<=o;v++){let T=!1;for(let g=0;g<_.length;g++){const D=_[g];if(D.row_number==f&&D.column_number==v){T=!0;break}}T||_.push({row_number:f,column_number:v,...j})}const e=new OffscreenCanvas(u,s),k=e.getContext("2d");for(let f=0;f<_.length;f++){const v=_[f];b.paint_hexagon(v,k,i)}postMessage({bitmap:e.transferToImageBitmap(),hexagon_definitions:_})}})();
