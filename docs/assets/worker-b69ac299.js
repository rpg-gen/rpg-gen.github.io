(function(){"use strict";const b={top_bar_height:2,top_bar_margin:.5,top_bar_padding:0,hex_grid_side_border:10,hex_grid_top_border:60,hex_grid_bottom_border:10,canvas_pixel_limit:8e3,hexagon_stroke_width:.1},_={unset:"#FFFFFF",ocean:"#a5c6fa",mountain:"#9d9fa1",bog:"#ffe4fd",forest:"#a1e070",plains:"#ddfec3",desert:"#fae4a7",hills:"#d1d2d3",white:"#ffffff",black:"#000000",road:"#664900",red:"#a83232",disabled:"#c2c2c2"};function c(r){return Math.round(Math.sqrt(3)*r)}function P(r){return r*2}function F(r){return r/2}function m(r,o){const i=r.row_number,s=r.column_number,t=c(o),u=(i%2==1?t/2:0)+t/2+t*(s-1)+b.hex_grid_side_border,e=b.hex_grid_top_border+o+o*1.5*(i-1);return[u,e]}function y(r,o){const i=c(o),[s,t]=m(r,o);return[{x:s,y:t-o},{x:s+i/2,y:t-o/2},{x:s+i/2,y:t+o/2},{x:s,y:t+o},{x:s-i/2,y:t+o/2},{x:s-i/2,y:t-o/2}]}function M(r,o){const i=c(o),[s,t]=m(r,o);return{top_left:{x:s-i/4,y:t-o*.75},top_right:{x:s+i/4,y:t-o*.75},right:{x:s+i/2,y:t},bottom_right:{x:s+i/4,y:t+o*.75},bottom_left:{x:s-i/4,y:t+o*.75},left:{x:s-i/2,y:t}}}function w(r,o){const i=c(o),[s,t]=m(r,o);return[{x:s,y:t-o/1.5},{x:s+i/2.5,y:t-o/5},{x:s+i/3,y:t-o/5},{x:s+i/3,y:t+o/2},{x:s-i/3,y:t+o/2},{x:s-i/3,y:t-o/5},{x:s-i/2.5,y:t-o/5}]}function T(r){const o=new Path2D;o.moveTo(r[0].x,r[0].y);for(let i=1;i<r.length;i++)o.lineTo(r[i].x,r[i].y);return o.closePath(),o}function D(r,o){return o*(r*1.5)+b.hex_grid_top_border+r/2+b.hex_grid_bottom_border}function z(r,o){const i=c(r);return b.hex_grid_side_border*2+i/2+i*o}function C(r,o,i){return i=="town"?w(r,o):[{x:0,y:0}]}function I(r,o,i){const s=a.get_canvas_path_2d(y(r,i));o.fillStyle=r.background_color_hexidecimal,o.fill(s),o.lineWidth=b.hexagon_stroke_width,o.strokeStyle=_.black,o.stroke(s)}function L(r,o,i){if(r.icon_name){const s=a.get_canvas_path_2d(C(r,i,"town"));o.lineJoin="round",o.lineWidth=10,o.fillStyle=_.black,o.strokeStyle=_.black,o.setLineDash([]),o.stroke(s),o.fill(s)}}function W(r,o,i){if(r.town_size>0){o.fillStyle=_.white,o.textAlign="center",o.textBaseline="middle";const s=i/2;o.font=s+"px sans-serif";const[t,u]=m(r,i);o.fillText(r.town_size.toString()+r.race.toString()+r.affinity.toString(),t,u)}}function l(r,o,i,s,t,u,e,v){r.setLineDash([]),e&&r.setLineDash([v/4]),r.strokeStyle=u,r.lineCap="butt",r.lineWidth=10,r.fillStyle=u,r.beginPath(),r.arc(o,i,5,0,2*Math.PI),r.fill(),r.beginPath(),r.moveTo(o,i),r.lineTo(s,t),r.stroke()}function B(r,o,i){const[s,t]=m(r,i),u=M(r,i);r.is_top_left_river&&l(o,s,t,u.top_left.x,u.top_left.y,_.ocean,!1,i),r.is_top_right_river&&l(o,s,t,u.top_right.x,u.top_right.y,_.ocean,!1,i),r.is_right_river&&l(o,s,t,u.right.x,u.right.y,_.ocean,!1,i),r.is_bottom_right_river&&l(o,s,t,u.bottom_right.x,u.bottom_right.y,_.ocean,!1,i),r.is_bottom_left_river&&l(o,s,t,u.bottom_left.x,u.bottom_left.y,_.ocean,!1,i),r.is_left_river&&l(o,s,t,u.left.x,u.left.y,_.ocean,!1,i),r.is_top_left_road&&l(o,s,t,u.top_left.x,u.top_left.y,_.road,!!r.is_top_left_river,i),r.is_top_right_road&&l(o,s,t,u.top_right.x,u.top_right.y,_.road,!!r.is_top_right_river,i),r.is_right_road&&l(o,s,t,u.right.x,u.right.y,_.road,!!r.is_right_river,i),r.is_bottom_right_road&&l(o,s,t,u.bottom_right.x,u.bottom_right.y,_.road,!!r.is_bottom_right_river,i),r.is_bottom_left_road&&l(o,s,t,u.bottom_left.x,u.bottom_left.y,_.road,!!r.is_bottom_left_river,i),r.is_left_road&&l(o,s,t,u.left.x,u.left.y,_.road,!!r.is_left_river,i)}function q(r,o,i,s){o.fillStyle=s;const[t,u]=m(r,i);o.beginPath(),o.arc(t,u,i/2,0,2*Math.PI),o.fill()}function A(r,o,i){I(r,o,i),B(r,o,i),L(r,o,i),W(r,o,i)}function J(r,o){const i=[r.column_number];return(r.row_number==o.row_number||r.row_number%2==1)&&i.push(r.column_number+1),(r.row_number==o.row_number||r.row_number%2==0)&&i.push(r.column_number-1),!!(Math.abs(r.row_number-o.row_number)<2&&i.includes(o.column_number))}function O(r,o,i){r.row_number==o.row_number&&r.column_number==o.column_number||(r.row_number==o.row_number?o.column_number>r.column_number?i=="river"?(r.is_right_river=!0,o.is_left_river=!0):i=="road"&&(r.is_right_road=!0,o.is_left_road=!0):i=="river"?(r.is_left_river=!0,o.is_right_river=!0):i=="road"&&(r.is_left_road=!0,o.is_right_road=!0):o.row_number<r.row_number?r.row_number%2==1?o.column_number==r.column_number?i=="river"?(r.is_top_left_river=!0,o.is_bottom_right_river=!0):i=="road"&&(r.is_top_left_road=!0,o.is_bottom_right_road=!0):i=="river"?(r.is_top_right_river=!0,o.is_bottom_left_river=!0):i=="road"&&(r.is_top_right_road=!0,o.is_bottom_left_road=!0):o.column_number==r.column_number?i=="river"?(r.is_top_right_river=!0,o.is_bottom_left_river=!0):i=="road"&&(r.is_top_right_road=!0,o.is_bottom_left_road=!0):i=="river"?(r.is_top_left_river=!0,o.is_bottom_right_river=!0):i=="road"&&(r.is_top_left_road=!0,o.is_bottom_right_road=!0):r.row_number%2==1?o.column_number==r.column_number?i=="river"?(r.is_bottom_left_river=!0,o.is_top_right_river=!0):i=="road"&&(r.is_bottom_left_road=!0,o.is_top_right_road=!0):i=="river"?(r.is_bottom_right_river=!0,o.is_top_left_river=!0):i=="road"&&(r.is_bottom_right_road=!0,o.is_top_left_road=!0):o.column_number==r.column_number?i=="river"?(r.is_bottom_right_river=!0,o.is_top_left_river=!0):i=="road"&&(r.is_bottom_right_road=!0,o.is_top_left_road=!0):i=="river"?(r.is_bottom_left_river=!0,o.is_top_right_river=!0):i=="road"&&(r.is_bottom_left_road=!0,o.is_top_right_road=!0))}const a={get_short_diagonal_length:c,get_long_diagonal_length:P,get_peak_height:F,get_hexagon_points:y,get_canvas_path_2d:T,get_canvas_height:D,get_canvas_width:z,get_center_point:m,get_house_points:w,paint_hexagon:A,is_neighboring_hex:J,paint_circle:q,add_path_definition:O},j={background_color_hexidecimal:_.white,is_top_left_river:!1,is_top_right_river:!1,is_right_river:!1,is_bottom_right_river:!1,is_bottom_left_river:!1,is_left_river:!1,is_top_left_road:!1,is_top_right_road:!1,is_right_road:!1,is_bottom_right_road:!1,is_bottom_left_road:!1,is_left_road:!1,town_size:0,affinity:0,race:0,icon_name:""};onmessage=r=>{const o=r.data.edge_length,i=r.data.num_rows,s=r.data.num_columns,t=r.data.hexagon_definitions,u=a.get_canvas_height(o,i),e=a.get_canvas_width(o,s);for(let n=1;n<=i;n++)for(let f=1;f<=i;f++){let k=!1;for(let p=0;p<t.length;p++){const S=t[p];if(S.row_number==n&&S.column_number==f){k=!0;break}}k||t.push({row_number:n,column_number:f,...j})}const v=new OffscreenCanvas(e,u),E=v.getContext("2d");for(let n=0;n<t.length;n++){const f=t[n];a.paint_hexagon(f,E,o)}postMessage({bitmap:v.transferToImageBitmap(),hexagon_definitions:t})}})();
