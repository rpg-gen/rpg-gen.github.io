(function(){"use strict";const f={top_bar_height:2,top_bar_margin:.5,top_bar_padding:0,hex_grid_side_border:10,hex_grid_top_border:60,hex_grid_bottom_border:10,canvas_pixel_limit:8e3,hexagon_stroke_width:.1},l={unset:"#FFFFFF",ocean:"#a5c6fa",mountain:"#9d9fa1",bog:"#ffe4fd",forest:"#a1e070",plains:"#ddfec3",desert:"#fae4a7",hills:"#d1d2d3",white:"#ffffff",black:"#000000",road:"#664900",red:"#a83232",disabled:"#c2c2c2"};function a(r){return Math.round(Math.sqrt(3)*r)}function F(r){return r*2}function L(r){return r/2}function c(r,o){const t=r.row_number,i=r.column_number,s=a(o),_=(t%2==1?s/2:0)+s/2+s*(i-1)+f.hex_grid_side_border,n=f.hex_grid_top_border+o+o*1.5*(t-1);return[_,n]}function k(r,o){const t=a(o),[i,s]=c(r,o);return[{x:i,y:s-o},{x:i+t/2,y:s-o/2},{x:i+t/2,y:s+o/2},{x:i,y:s+o},{x:i-t/2,y:s+o/2},{x:i-t/2,y:s-o/2}]}function M(r,o){const t=a(o),[i,s]=c(r,o);return{top_left:{x:i-t/4,y:s-o*.75},top_right:{x:i+t/4,y:s-o*.75},right:{x:i+t/2,y:s},bottom_right:{x:i+t/4,y:s+o*.75},bottom_left:{x:i-t/4,y:s+o*.75},left:{x:i-t/2,y:s}}}function S(r,o){const t=a(o),[i,s]=c(r,o);return[{x:i,y:s-o/1.5},{x:i+t/2.5,y:s-o/5},{x:i+t/3,y:s-o/5},{x:i+t/3,y:s+o/2},{x:i-t/3,y:s+o/2},{x:i-t/3,y:s-o/5},{x:i-t/2.5,y:s-o/5}]}function A(r){const o=new Path2D;o.moveTo(r[0].x,r[0].y);for(let t=1;t<r.length;t++)o.lineTo(r[t].x,r[t].y);return o.closePath(),o}function G(r,o){return o*(r*1.5)+f.hex_grid_top_border+r/2+f.hex_grid_bottom_border}function N(r,o){const t=a(r);return f.hex_grid_side_border*2+t/2+t*o}function C(r,o,t){return t=="town"?S(r,o):[{x:0,y:0}]}function E(r,o,t){const i=p.get_canvas_path_2d(k(r,t));o.fillStyle=r.background_color_hexidecimal,o.fill(i),o.lineWidth=f.hexagon_stroke_width,o.strokeStyle=l.black,o.stroke(i)}function H(r,o,t){if(r.icon_name){const i=p.get_canvas_path_2d(C(r,t,"town"));o.lineJoin="round",o.lineWidth=10,o.fillStyle=l.black,o.strokeStyle=l.black,o.setLineDash([]),o.stroke(i),o.fill(i)}}function W(r,o,t){if(r.town_size>0){o.fillStyle=l.white,o.textAlign="center",o.textBaseline="middle";const i=t/2;o.font=i+"px sans-serif";const[s,_]=c(r,t);o.fillText(r.town_size.toString()+r.race.toString()+r.affinity.toString(),s,_)}}function u(r,o,t,i,s,_,n,m){r.setLineDash([]),n&&r.setLineDash([m/4]),r.strokeStyle=_,r.lineCap="butt",r.lineWidth=10,r.fillStyle=_,r.beginPath(),r.arc(o,t,5,0,2*Math.PI),r.fill(),r.beginPath(),r.moveTo(o,t),r.lineTo(i,s),r.stroke()}function B(r,o,t){const[i,s]=c(r,t),_=M(r,t);r.is_top_left_river&&u(o,i,s,_.top_left.x,_.top_left.y,l.ocean,!1,t),r.is_top_right_river&&u(o,i,s,_.top_right.x,_.top_right.y,l.ocean,!1,t),r.is_right_river&&u(o,i,s,_.right.x,_.right.y,l.ocean,!1,t),r.is_bottom_right_river&&u(o,i,s,_.bottom_right.x,_.bottom_right.y,l.ocean,!1,t),r.is_bottom_left_river&&u(o,i,s,_.bottom_left.x,_.bottom_left.y,l.ocean,!1,t),r.is_left_river&&u(o,i,s,_.left.x,_.left.y,l.ocean,!1,t),r.is_top_left_road&&u(o,i,s,_.top_left.x,_.top_left.y,l.road,!!r.is_top_left_river,t),r.is_top_right_road&&u(o,i,s,_.top_right.x,_.top_right.y,l.road,!!r.is_top_right_river,t),r.is_right_road&&u(o,i,s,_.right.x,_.right.y,l.road,!!r.is_right_river,t),r.is_bottom_right_road&&u(o,i,s,_.bottom_right.x,_.bottom_right.y,l.road,!!r.is_bottom_right_river,t),r.is_bottom_left_road&&u(o,i,s,_.bottom_left.x,_.bottom_left.y,l.road,!!r.is_bottom_left_river,t),r.is_left_road&&u(o,i,s,_.left.x,_.left.y,l.road,!!r.is_left_river,t)}function q(r,o,t,i){o.fillStyle=i;const[s,_]=c(r,t);o.beginPath(),o.arc(s,_,t/2,0,2*Math.PI),o.fill()}function J(r,o,t){E(r,o,t),B(r,o,t),H(r,o,t),W(r,o,t)}function O(r,o){const t=[r.column_number];return(r.row_number==o.row_number||r.row_number%2==1)&&t.push(r.column_number+1),(r.row_number==o.row_number||r.row_number%2==0)&&t.push(r.column_number-1),!!(Math.abs(r.row_number-o.row_number)<2&&t.includes(o.column_number))}function R(r,o,t){r.row_number==o.row_number&&r.column_number==o.column_number||(r.row_number==o.row_number?o.column_number>r.column_number?t=="river"?(r.is_right_river=!0,o.is_left_river=!0):t=="road"&&(r.is_right_road=!0,o.is_left_road=!0):t=="river"?(r.is_left_river=!0,o.is_right_river=!0):t=="road"&&(r.is_left_road=!0,o.is_right_road=!0):o.row_number<r.row_number?r.row_number%2==1?o.column_number==r.column_number?t=="river"?(r.is_top_left_river=!0,o.is_bottom_right_river=!0):t=="road"&&(r.is_top_left_road=!0,o.is_bottom_right_road=!0):t=="river"?(r.is_top_right_river=!0,o.is_bottom_left_river=!0):t=="road"&&(r.is_top_right_road=!0,o.is_bottom_left_road=!0):o.column_number==r.column_number?t=="river"?(r.is_top_right_river=!0,o.is_bottom_left_river=!0):t=="road"&&(r.is_top_right_road=!0,o.is_bottom_left_road=!0):t=="river"?(r.is_top_left_river=!0,o.is_bottom_right_river=!0):t=="road"&&(r.is_top_left_road=!0,o.is_bottom_right_road=!0):r.row_number%2==1?o.column_number==r.column_number?t=="river"?(r.is_bottom_left_river=!0,o.is_top_right_river=!0):t=="road"&&(r.is_bottom_left_road=!0,o.is_top_right_road=!0):t=="river"?(r.is_bottom_right_river=!0,o.is_top_left_river=!0):t=="road"&&(r.is_bottom_right_road=!0,o.is_top_left_road=!0):o.column_number==r.column_number?t=="river"?(r.is_bottom_right_river=!0,o.is_top_left_river=!0):t=="road"&&(r.is_bottom_right_road=!0,o.is_top_left_road=!0):t=="river"?(r.is_bottom_left_river=!0,o.is_top_right_river=!0):t=="road"&&(r.is_bottom_left_road=!0,o.is_top_right_road=!0))}function I(){return{row_number:1,column_number:1,background_color_hexidecimal:l.white,is_top_left_river:!1,is_top_right_river:!1,is_right_river:!1,is_bottom_right_river:!1,is_bottom_left_river:!1,is_left_river:!1,is_top_left_road:!1,is_top_right_road:!1,is_right_road:!1,is_bottom_right_road:!1,is_bottom_left_road:!1,is_left_road:!1,town_size:0,affinity:0,race:0,icon_name:""}}function y(r,o){const i="0",s=r.toString().padStart(3,i),_=o.toString().padStart(3,i);return s+"_"+_}function j(r){const o=[],t=parseInt(r.height),i=parseInt(r.width);for(let s=1;s<=t;s++)for(let _=1;_<=i;_++){const n=y(s,_),m=r[n],b=I();m!=null?T(n,m,b):(b.row_number=s,b.column_number=_),o.push(b)}return o}function P(r){return r.background_color_hexidecimal+"_"+(r.is_top_left_river?1:0)+"_"+(r.is_top_right_river?1:0)+"_"+(r.is_right_river?1:0)+"_"+(r.is_bottom_right_river?1:0)+"_"+(r.is_bottom_left_river?1:0)+"_"+(r.is_left_river?1:0)+"_"+(r.is_top_left_road?1:0)+"_"+(r.is_top_right_road?1:0)+"_"+(r.is_right_road?1:0)+"_"+(r.is_bottom_right_road?1:0)+"_"+(r.is_bottom_left_road?1:0)+"_"+(r.is_left_road?1:0)+"_"+r.town_size+"_"+r.affinity+"_"+r.race+"_"+r.icon_name}function T(r,o,t){const i=o.split("_"),s=parseInt(r.split("_")[0]),_=parseInt(r.split("_")[1]);return t.row_number=s,t.column_number=_,t.background_color_hexidecimal=i[0],t.is_top_left_river=i[1]=="1",t.is_top_right_river=i[2]=="1",t.is_right_river=i[3]=="1",t.is_bottom_right_river=i[4]=="1",t.is_bottom_left_river=i[5]=="1",t.is_left_river=i[6]=="1",t.is_top_left_road=i[7]=="1",t.is_top_right_road=i[8]=="1",t.is_right_road=i[9]=="1",t.is_bottom_right_road=i[10]=="1",t.is_bottom_left_road=i[11]=="1",t.is_left_road=i[12]=="1",t.town_size=parseInt(i[13]),t.affinity=parseInt(i[14]),t.race=parseInt(i[15]),t.icon_name=i[16],t}function K(r,o){const t=[];for(let i=0;i<r.length;i++){const s=r[i],_=P(s),n=y(s.row_number,s.column_number),m=o[n];m!=null&&_!=m&&(T(n,m,s),t.push(s))}return t}const p={get_short_diagonal_length:a,get_long_diagonal_length:F,get_peak_height:L,get_hexagon_points:k,get_canvas_path_2d:A,get_canvas_height:G,get_canvas_width:N,get_center_point:c,get_house_points:S,paint_hexagon:J,is_neighboring_hex:O,paint_circle:q,add_path_definition:R,get_default_hexagon_definition:I,get_starting_hexagon_definitions:j,get_hexagon_definition_key:y,get_encoded_hexagon_definition:P,get_changed_hexagon_definitions:K},Q={background_color_hexidecimal:l.white,is_top_left_river:!1,is_top_right_river:!1,is_right_river:!1,is_bottom_right_river:!1,is_bottom_left_river:!1,is_left_river:!1,is_top_left_road:!1,is_top_right_road:!1,is_right_road:!1,is_bottom_right_road:!1,is_bottom_left_road:!1,is_left_road:!1,town_size:0,affinity:0,race:0,icon_name:""};onmessage=r=>{const o=r.data.edge_length,t=r.data.num_rows,i=r.data.num_columns,s=r.data.hexagon_definitions,_=p.get_canvas_height(o,t),n=p.get_canvas_width(o,i);for(let e=1;e<=t;e++)for(let v=1;v<=t;v++){let D=!1;for(let w=0;w<s.length;w++){const z=s[w];if(z.row_number==e&&z.column_number==v){D=!0;break}}D||s.push({row_number:e,column_number:v,...Q})}const m=new OffscreenCanvas(n,_),b=m.getContext("2d");for(let e=0;e<s.length;e++){const v=s[e];p.paint_hexagon(v,b,o)}postMessage({bitmap:m.transferToImageBitmap(),hexagon_definitions:s})}})();
